<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="/APP-Scheda/manifest.json">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0d6efd">
  <link rel="icon" href="/APP-Scheda/icon-192.png" type="image/png">
  <link rel="apple-touch-icon" href="/APP-Scheda/icon-192.png">
  <title>Scheda Valutazione X-A-B-C-D-E</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/print.css" media="print">

</head>

<body>
  <h1>Scheda Valutazione X-A-B-C-D-E</h1>


  <form>

    <div class="section">
      <label>Data</label>
      <input type="date" name="data" data-label="Data">
      <label>Orario valutazione</label>
      <input type="time" name="orario" data-label="Ora">
    </div>

    <div class="section">
      <h2>Sezione X - Emorragia Massiva</h2>
      <label>Emorragia massiva</label>
      <div class="checkbox-group exclusive-group">
        <label><input type="checkbox" name="emorragia_x" value="Sì" data-label="Emorragia massiva"> Sì</label>
        <label><input type="checkbox" name="emorragia_x" value="No" data-label="Emorragia massiva"> No</label>
      </div>


      <label>Presidi e valutazione X</label>
      <div class="checkbox-group">
        <label><input type="checkbox" name="x_presidi" value="Compressione" data-label="Presidi e valutazione X">
          Compressione manuale dell'emorragia</label>
        <label><input type="checkbox" name="x_presidi" value="Medicazione" data-label="Presidi e valutazione X">
          Medicazione compressiva</label>
        <label><input type="checkbox" name="x_presidi" value="Israele" data-label="Presidi e valutazione X"> Benda
          israeliana</label>
        <label><input type="checkbox" name="x_presidi" value="Tourniquet" data-label="Presidi e valutazione X">
          Tourniquet</label>
      </div>
    </div>

    <div class="section">
      <h2>Sezione A - Vie aeree e rachide cervicale</h2>
      <p>Se paziente <b> non respira</b>:<br>
      <ul>
        <li>Massaggio cardiaco esterno</li>
        <li>Ventila pallone autoespandibie + filtro Hepa (30:2)</li>
        <li>DAE</li>
      </ul>
      <label>Coscienza</label>
      <div class="checkbox-group exclusive-group">
        <label><input type="checkbox" name="coscienza" value="Sì" data-label="Cosciente"> Sì</label>
        <label><input type="checkbox" name="coscienza" value="No"> No</label>
      </div>

      <label>Respira</label>
      <div class="checkbox-group exclusive-group">
        <label><input type="checkbox" name="respira" value="Sì" data-label="Respira"> Sì</label>
        <label><input type="checkbox" name="respira" value="No" data-label="Respira"> No</label>
      </div>


      <label>Vie aeree</label>
      <div class="checkbox-group exclusive-group">
        <label><input type="checkbox" name="vie_aeree" value="Pervie" data-label="Vie aeree"> Pervie</label>
        <label><input type="checkbox" name="vie_aeree" value="Ostruite" data-label="Vie aeree"> Ostruite</label>
      </div>


      <label>Immobilizzazione manuale rachide cervicale</label>
      <div class="checkbox-group exclusive-group">
        <label><input type="checkbox" name="immobilizzazione" value="Sì"
            data-label="Immobilizzazione manuale rachide cervicale"> Sì</label>
        <label><input type="checkbox" name="immobilizzazione" value="No"
            data-label="Immobilizzazione manuale rachide cervicale"> No</label>
      </div>


      <label>Presidi e valutazione</label>
      <div class="checkbox-group">
        <label><input type="checkbox" name="a_presidi" value="Collare" data-label="Presidi e valutazione B"> Collare
          cervicale</label>
        <label><input type="checkbox" name="a_presidi" value="Disostruzione" data-label="Presidi e valutazione B">
          Disostruzione/aspirazione</label>
        <label><input type="checkbox" name="a_presidi" value="Cannula" data-label="Presidi e valutazione B"> Cann.
          orofaringea/nasofaringea</label>
        <label><input type="checkbox" name="a_presidi" value="Ventilazione" data-label="Presidi e valutazione B">
          Ventila con pallone</label>
      </div>
    </div>

    <div class="section">
      <h2>Sezione B - Qualità Respiro</h2>
      <label>Difficoltà respiratoria</label>
      <div class="radio-group">
        <label><input type="radio" name="difficolta_respiratoria" value="Sì" data-label="Difficoltà respiratoria">
          Sì</label>
        <label><input type="radio" name="difficolta_respiratoria" value="No" data-label="Difficoltà respiratoria">
          No</label>
      </div>

      <label>OPACS</label>
      <div class="checkbox-group">
        <label><input type="checkbox" name="opacs" value="O_simmetrico" data-label="OPACS">O - espande
          simmetrico</label>
        <label><input type="checkbox" name="opacs" value="P_enfisema" data-label="OPACS">P - enfisema
          sottocute/dolore/ferite</label>
        <label><input type="checkbox" name="opacs" value="A_rumori" data-label="OPACS">A - rumori respiratori
          anomali</label>
      </div>

      <label>Frequenza respiratoria</label>
      <div style="display:flex; align-items:center; gap:5px;">
        <button type="button" id="btn_fr_minus">-</button>
        <input type="number" name="frequenza_respiratoria" data-min="1" data-max="60" inputmode="numeric"
          pattern="[0-9]*" data-label="Frequenza respiratoria" data-type="soft" id="frequenza_respiratoria">
        <button type="button" id="btn_fr_plus">+</button>
      </div>

      <p class=" note">Valori normali 12-20 atti al minuto</p>

      <label>Saturimetria</label>
      <div style="display:flex; align-items:center; gap:5px;">
        <button type="button" id="btn_spo2_minus">-</button>
        <input type="number" name="saturimetria" data-min="50" data-max="100" inputmode="numeric" pattern="[0-9]*"
          data-label="Saturimetria" data-type="hard" required id="saturimetria">
        <button type="button" id="btn_spo2_plus">+</button>
      </div>
      <p class="note">Valori normali >94%</p>
    </div>

    <div class="section">
      <h2>Sezione C - Qualità del circolo</h2>
      <label>Valutazioni circolatorie</label>
      <table>
        <tr>
          <td>Polso periferico</td>
          <td>
            <div class="checkbox-group exclusive-group">
              <label><input type="checkbox" name="polso_periferico" value="Sì" data-label="Polso periferico">
                Sì</label>
              <label><input type="checkbox" name="polso_periferico" value="No" data-label="Polso periferico">
                No</label>
            </div>
          </td>
        </tr>

        <tr>
          <td>Polso centrale (solo se assente il periferico)</td>
          <td>
            <div class="checkbox-group exclusive-group">
              <label><input type="checkbox" name="polso_centrale" value="Sì" data-label="Polso centrale"> Sì</label>
              <label><input type="checkbox" name="polso_centrale" value="No" data-label="Polso centrale"> No</label>
            </div>
          </td>
        </tr>

        <tr>
          <td>Ferite esterne</td>
          <td>
            <div class="checkbox-group exclusive-group">
              <label><input type="checkbox" name="ferite_esterne" value="Sì" data-label="Ferite esterne"> Sì</label>
              <label><input type="checkbox" name="ferite_esterne" value="No" data-label="Ferite esterne"> No</label>
            </div>
          </td>
        </tr>

      </table>

      <label>Frequenza cardiaca</label>
      <div style="display:flex; align-items:center; gap:5px;">
        <button type="button" id="btn_fc_minus">-</button>
        <input type="number" name="frequenza_cardiaca" data-min="0" data-max="200" inputmode="numeric" pattern="[0-9]*"
          data-label="Frequenza cardiaca" data-type="soft" id="frequenza_cardiaca">
        <button type="button" id="btn_fc_plus">+</button>
      </div>




      <p class="note">Valori normali 60 - 100 atti al minuto</p>

      <label>Note</label>
      <div class="checkbox-group">
        <label><input type="checkbox" data-label="Note"> Polso forte</label>
        <label><input type="checkbox" data-label="Note"> Polso debole</label>
        <label><input type="checkbox" data-label="Note"> Polso irregolare</label>
        <label><input type="checkbox" data-label="Note"> Cute sudata</label>
        <label><input type="checkbox" data-label="Note"> Cute fredda</label>
        <label><input type="checkbox" data-label="Note"> Cute pallida</label>
        <label><input type="checkbox" data-label="Note"> Cute cianotica</label>
        <label><input type="checkbox" data-label="Note"> Medicazione ferite</label>
      </div>

      <label>Bacino</label>
      <div class="checkbox-group">
        <label><input type="checkbox" data-label="Bacino"> Deformato</label>
        <label><input type="checkbox" data-label="Bacino"> Dolore</label>
        <label><input type="checkbox" data-label="Bacino"> Fascia pelvica</label>
      </div>
    </div>

    <div class="section">
      <h2>Sezione D - Neurologico</h2>
      <label>AVPU</label>
      <div class="radio-group">
        <label>
          <input type="radio" name="avpu" value="A - Sveglio, risponde a tono e collabora" data-label="AVPU">
          A - Sveglio, risponde a tono e collabora
        </label>
        <label>
          <input type="radio" name="avpu" value="V - Risponde se chiamato, confuso, poco collaborante"
            data-label="AVPU">
          V - Risponde se chiamato, confuso, poco collaborante
        </label>
        <label>
          <input type="radio" name="avpu" value="P - Soporoso, non risponde, reagisce solo al dolore" data-label="AVPU">
          P - Soporoso, non risponde, reagisce solo al dolore
        </label>
        <label>
          <input type="radio" name="avpu" value="U - Non reagisce a nessuno stimolo" data-label="AVPU">
          U - Non reagisce a nessuno stimolo
        </label>
      </div>


      <label>Neurologico</label>
      <div class="checkbox-group">
        <label><input type="checkbox" data-label="Neurologico"> Trauma cranico</label>
        <label><input type="checkbox" data-label="Neurologico"> Agitazione psicomotoria</label>
        <label><input type="checkbox" data-label="Neurologico"> Convulsioni</label>
      </div>

      <label>Deficit forza arto</label>
      <div class="checkbox-group">
        <label><input type="checkbox" data-label="Deficit forza arto"> Sup. DX</label>
        <label><input type="checkbox" data-label="Deficit forza arto"> Sup. SX</label>
        <label><input type="checkbox" data-label="Deficit forza arto"> Inf. DX</label>
        <label><input type="checkbox" data-label="Deficit forza arto"> Inf. SX</label>
      </div>

      <label>Deficit sensibilità arto</label>
      <div class="checkbox-group">
        <label><input type="checkbox" data-label="Deficit sensibilità arto"> Sup. DX</label>
        <label><input type="checkbox" data-label="Deficit sensibilità arto"> Sup. SX</label>
        <label><input type="checkbox" data-label="Deficit sensibilità arto"> Inf. DX</label>
        <label><input type="checkbox" data-label="Deficit sensibilità arto"> Inf. SX</label>
      </div>

      <label>Non muove</label>
      <input type="text" name="non_muove" data-label="Non muove">

      <label>Non sente toccare</label>
      <input type="text" name="non_sente" data-label="Non sente toccare">
    </div>

    <div class="section">
      <h2>Sezione E - Testa piedi ed AMPIA</h2>
      <label><strong>Esegui testa-piedi</strong></label>
      <div class="checkbox-group">
        <label><input type="checkbox" data-label="Esegui testa-piedi" id="testaPiedi" required> Fatto</label>
      </div>

      <label>Dolore (1-10)</label>
      <input type="number" name="dolore" data-min="1" data-max="10" inputmode="numeric" pattern="[0-9]*"
        data-label="Dolore (1-10)" data-type="hard" required>

      <label>Allergie</label>
      <input type="text" name="allergie" data-label="Allergie">

      <label>Medicinali</label>
      <input type="text" name="medicinali" data-label="Medicinali">

      <label>Patologie</label>
      <input type="text" name="patologie" data-label="Patologie">

      <label>Ultimo pasto</label>
      <input type="text" name="ultimo_pasto" data-label="Ultimo pasto">

      <label>Altro</label>
      <input type="text" name="altro" data-label="Altro">
    </div>
  </form>

  <div style="text-align: center; margin-top: 30px;">
    <button type="button" onclick="generaPDF()">Salva PDF</button>
  </div>
   <div style="text-align: center; margin-top: 30px;">
  <button type="button" id="genera-pdf">Scarica PDF Scheda Sanitaria</button>
   </div>
</form>

<script type="module">
import { PDFDocument } from 'https://cdn.skypack.dev/pdf-lib';

async function compilaPdf() {
  // Carica il PDF esistente
  const formPdfBytes = await fetch('scheda_sanitaria_fields.pdf').then(res => res.arrayBuffer());
  const pdfDoc = await PDFDocument.load(formPdfBytes);
  const form = pdfDoc.getForm();

  // Scansiona i campi del form HTML
  document.querySelectorAll('#mio-form input, #mio-form select, #mio-form textarea').forEach(input => {
    const nomeCampoPdf = generaNomeCampoPdf(input);

    if (input.type === 'checkbox') {
      if (input.checked) {
        try { form.getCheckBox(nomeCampoPdf).check(); } catch (err) { console.warn(nomeCampoPdf, err); }
      }
    } else if (input.type === 'radio') {
      if (input.checked) {
        try { form.getRadioGroup(input.name).select(input.value); } catch (err) { console.warn(input.name, err); }
      }
    } else {
      if (input.value) {
        try { form.getTextField(nomeCampoPdf).setText(input.value); } catch (err) { console.warn(nomeCampoPdf, err); }
      }
    }
  });

  // Salva e scarica il PDF compilato
  const pdfBytes = await pdfDoc.save();
  download(pdfBytes, 'modulo_compilato.pdf', 'application/pdf');
}

function generaNomeCampoPdf(input) {
  if (input.type === 'checkbox') {
    return `${input.name}_${input.value.replace(/\s+/g, '_')}`;
  }
  return input.name;
}

function download(data, filename, type) {
  const blob = new Blob([data], { type });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = filename;
  link.click();
}

document.getElementById('genera-pdf').addEventListener('click', compilaPdf);
</script>



  <!--Libreria-->
  <script src="libs/jspdf.umd.min.js"></script>
  <script src="libs/jspdf.plugin.autotable.min.js"></script>

  <!--Esporta in pdf-->
  <script src="js/pdf.js"></script>


  <script src="js/date-time.js"></script>
  <script src="js/incrementButton.js"></script>
  <script src="js/exclusiveCheckbox.js"></script>
  <script src="js/checkValue.js"></script>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/APP-Scheda/service-worker.js')
        .then(reg => console.log('✅ Service Worker registrato'))
        .catch(err => console.error('❌ Errore Service Worker:', err));
    }
  </script>

</body>

</html>
